<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>MMORPG</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#1a1d23;--card:#23272f;--border:#363b44;--text:#e8e6e3;--dim:#9a9fa8;--muted:#5c6370;--accent:#c9a227;--hp:#c94a4a;--xp:#8b5cf6;--ok:#4ade80;--bad:#ef4444;--warn:#f59e0b}
html,body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:0;height:100%;width:100%}
body{max-width:480px;margin:0 auto;height:100vh;display:flex;flex-direction:column;overflow:hidden;user-select:none}
.hdr{background:var(--card);padding:10px 12px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border)}
.avatar{width:40px;height:40px;background:var(--bg);border-radius:8px;display:flex;align-items:center;justify-content:center;border:2px solid var(--accent)}
.hdr-info{flex:1}.hdr-name{font-weight:600;font-size:14px}
.bar{height:6px;background:#3d2a2a;border-radius:3px;margin-top:4px}.bar-fill{height:100%;border-radius:3px;transition:width .3s}.bar-hp{background:var(--hp)}
.gold{display:flex;align-items:center;gap:4px;color:var(--accent);font-weight:600}
.main{flex:1;overflow-y:auto;padding:12px;padding-bottom:70px}
.screen{display:none}.screen.active{display:block}
.card{background:var(--card);border-radius:10px;padding:12px;margin-bottom:10px;border:1px solid var(--border)}
.card-title{font-size:12px;font-weight:600;color:var(--dim);text-transform:uppercase;margin-bottom:10px}
.btn{padding:10px 14px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:6px}
.btn-p{background:var(--accent);color:#000}.btn-s{background:var(--bg);color:var(--text);border:1px solid var(--border)}
.btn-d{background:var(--bad);color:#fff}.btn:disabled{opacity:.4;cursor:not-allowed}.btn-sm{padding:6px 10px;font-size:12px}
.tabs{display:flex;gap:4px;margin-bottom:12px;background:var(--bg);padding:4px;border-radius:8px}
.tab{flex:1;padding:8px;background:none;border:none;border-radius:6px;color:var(--dim);font-size:12px;cursor:pointer}.tab.active{background:var(--card);color:var(--text)}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600}
.badge-ok{background:rgba(74,222,128,.2);color:var(--ok)}.badge-warn{background:rgba(245,158,11,.2);color:var(--warn)}.badge-bad{background:rgba(239,68,68,.2);color:var(--bad)}
.map-view{position:relative;height:200px;background:var(--bg);border-radius:8px;overflow:hidden;margin-bottom:10px}
.map-node{position:absolute;width:24px;height:24px;background:var(--card);border:2px solid var(--border);border-radius:50%;transform:translate(-50%,-50%);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s}
.map-node.current{border-color:var(--accent);background:var(--accent);color:#000}
.map-node.exit{border-color:var(--ok)}
.map-path{position:absolute;background:var(--border);height:2px;transform-origin:left center}
.map-player{position:absolute;font-size:16px;transform:translate(-50%,-50%);z-index:10;transition:all .5s}
.step-btn{width:100%;padding:14px;position:relative;overflow:hidden}
.step-prog{position:absolute;left:0;top:0;height:100%;background:rgba(255,255,255,.2);width:0;transition:width .1s linear}
.event{text-align:center;padding:16px}
.event-icon{width:64px;height:64px;margin:0 auto 12px;background:var(--bg);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;border:2px solid var(--border)}
.event-icon.enemy{border-color:var(--bad)}.event-icon.res{border-color:var(--ok)}.event-icon.player{border-color:var(--xp)}
.event-title{font-size:16px;font-weight:700;margin-bottom:6px}
.event-stats{display:flex;justify-content:center;gap:12px;font-size:13px;color:var(--dim);margin:8px 0}
.event-acts{display:flex;gap:6px;margin-top:12px;justify-content:center;flex-wrap:wrap}
.gather-btn{width:100%;padding:16px;position:relative;touch-action:none}
.gather-prog{height:4px;background:var(--bg);border-radius:2px;margin-top:8px;overflow:hidden}
.gather-prog-fill{height:100%;background:var(--ok);transition:width .05s linear}
.combat{background:linear-gradient(180deg,#2a1f1f,var(--card));border-color:var(--bad)}
.fighter{display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;margin-bottom:8px}
.fighter-ava{width:44px;height:44px;background:var(--card);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:22px}
.fighter-info{flex:1}.fighter-name{font-weight:600;font-size:13px;margin-bottom:4px}
.fighter-hp{height:10px;background:#3d2a2a;border-radius:5px;overflow:hidden;position:relative}
.fighter-hp-fill{height:100%;background:linear-gradient(90deg,#b91c1c,var(--hp));transition:width .3s}
.fighter-hp-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:9px;font-weight:700}
.abilities{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:12px}
.abil-btn{padding:10px 8px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;text-align:left}
.abil-btn:hover{border-color:var(--accent)}.abil-btn:disabled{opacity:.5}
.abil-name{font-weight:600;font-size:12px}.abil-desc{font-size:10px;color:var(--muted)}
.turn-indicator{text-align:center;padding:8px;font-size:12px;color:var(--accent);font-weight:600}
.log{max-height:80px;overflow-y:auto;background:var(--bg);border-radius:6px;padding:8px;margin-top:10px;font-size:11px}
.log-dmg{color:var(--bad)}.log-heal{color:var(--ok)}
.inv-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.inv-slot{aspect-ratio:1;background:var(--bg);border:1px solid var(--border);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;font-size:20px;position:relative}
.inv-slot:hover{border-color:var(--accent)}.inv-slot.empty{opacity:.3;cursor:default}
.inv-slot.eq{border-color:var(--accent);background:rgba(201,162,39,.1)}
.inv-slot .eq-dot{position:absolute;top:3px;right:3px;width:6px;height:6px;background:var(--accent);border-radius:50%}
.inv-slot .name{font-size:8px;color:var(--dim);text-align:center;line-height:1.1;margin-top:2px}
.eq-panel{display:flex;justify-content:center;gap:6px;margin-bottom:12px;flex-wrap:wrap}
.eq-slot{width:48px;height:48px;background:var(--bg);border:1px dashed var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--muted)}
.eq-slot.filled{border-style:solid;border-color:var(--accent);color:var(--text)}
.res-bar{display:flex;gap:4px;flex-wrap:wrap}
.res-item{display:flex;align-items:center;gap:4px;padding:6px 10px;background:var(--bg);border-radius:6px;font-size:12px}
.loc-item{display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border:1px solid var(--border);border-radius:10px;margin-bottom:6px;cursor:pointer}
.loc-item:hover{border-color:var(--accent)}.loc-item.current{border-color:var(--ok)}
.craft-item{display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:10px;margin-bottom:6px}
.craft-icon{width:40px;height:40px;background:var(--card);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px}
.craft-info{flex:1}.craft-name{font-weight:600;font-size:13px}
.craft-reqs{display:flex;gap:6px;font-size:11px;margin-top:2px;flex-wrap:wrap}
.craft-req{padding:2px 5px;background:var(--card);border-radius:3px}.craft-req.ok{color:var(--ok)}.craft-req.no{color:var(--bad)}
.mast-item{display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;margin-bottom:6px}
.mast-icon{width:36px;height:36px;background:var(--card);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px}
.mast-info{flex:1}.mast-head{display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px}.mast-lv{color:var(--xp);font-weight:600}
.mast-bar{height:4px;background:var(--bg);border-radius:2px}.mast-bar-fill{height:100%;background:var(--xp);border-radius:2px}
.auc-filters{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;align-items:center}
.auc-filters select,.auc-filters input{padding:6px 8px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px}
.auc-filters input[type=text]{flex:1;min-width:80px}
.auc-group{background:var(--bg);border-radius:8px;margin-bottom:6px;overflow:hidden}
.auc-group-head{display:flex;align-items:center;gap:8px;padding:10px;cursor:pointer}
.auc-group-head:hover{background:var(--card)}
.auc-icon{width:32px;height:32px;background:var(--card);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:16px}
.auc-group-info{flex:1}.auc-group-name{font-weight:600;font-size:13px}.auc-group-meta{font-size:10px;color:var(--muted)}
.auc-group-price{color:var(--accent);font-weight:600;font-size:13px}
.auc-orders{padding:0 10px 10px;display:none}.auc-orders.open{display:block}
.auc-order{display:flex;align-items:center;gap:8px;padding:6px;background:var(--card);border-radius:6px;margin-bottom:4px;font-size:12px}
.auc-order-info{flex:1}.auc-order-price{color:var(--accent)}
.bank-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:10px}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:100;padding:16px}
.modal.active{display:flex}
.modal-box{background:var(--card);border-radius:12px;padding:16px;width:100%;max-width:320px;max-height:80vh;overflow-y:auto}
.modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.modal-title{font-size:16px;font-weight:700}.modal-close{width:28px;height:28px;background:var(--bg);border:none;border-radius:6px;color:var(--dim);cursor:pointer;font-size:16px}
.nav{position:fixed;bottom:0;left:0;right:0;max-width:480px;margin:0 auto;background:var(--card);border-top:1px solid var(--border);display:flex;padding:6px}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px;background:none;border:none;color:var(--muted);cursor:pointer;border-radius:6px;font-size:10px}.nav-item.active{color:var(--accent)}
.toggle{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--dim)}
.toggle input{width:36px;height:20px;appearance:none;background:var(--bg);border-radius:10px;position:relative;cursor:pointer}
.toggle input::after{content:'';position:absolute;width:16px;height:16px;background:var(--dim);border-radius:50%;top:2px;left:2px;transition:.2s}
.toggle input:checked{background:var(--accent)}.toggle input:checked::after{left:18px;background:#fff}
</style>
</head>
<body>
<div class="hdr">
<div class="avatar" id="avatar">üë§</div>
<div class="hdr-info"><div class="hdr-name" id="hdrName">–ò–≥—Ä–æ–∫</div><div class="bar"><div class="bar-fill bar-hp" id="hdrHp" style="width:100%"></div></div></div>
<div class="gold">üí∞ <span id="hdrGold">150</span></div>
</div>
<div class="main">
<div class="screen active" id="sExplore">
<div class="card">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
<div><span id="locName" style="font-weight:700">–õ—É–≥–∞</span> <span class="badge badge-warn" id="locBadge">PvP</span></div>
<span style="font-size:11px;color:var(--dim)" id="locTier">–£—Ä.1</span>
</div>
<div class="map-view" id="mapView"></div>
<button class="btn btn-p step-btn" id="stepBtn">
<span class="step-prog" id="stepProg"></span>
<span id="stepText">üö∂ –°–¥–µ–ª–∞—Ç—å —à–∞–≥</span>
</button>
</div>
<div class="card event" id="eventCard"></div>
<div class="card combat" id="combatCard" style="display:none">
<div class="fighter"><div class="fighter-ava" id="cEnemyAva">üê∫</div><div class="fighter-info"><div class="fighter-name" id="cEnemyName">–í–æ–ª–∫</div><div class="fighter-hp"><div class="fighter-hp-fill" id="cEnemyHp"></div><span class="fighter-hp-text" id="cEnemyHpTxt"></span></div></div></div>
<div class="turn-indicator" id="turnInd">–í–∞—à —Ö–æ–¥</div>
<div class="fighter"><div class="fighter-ava">üë§</div><div class="fighter-info"><div class="fighter-name">–í—ã</div><div class="fighter-hp"><div class="fighter-hp-fill" id="cPlayerHp"></div><span class="fighter-hp-text" id="cPlayerHpTxt"></span></div></div></div>
<div class="abilities" id="abilGrid"></div>
<div class="log" id="combatLog"></div>
</div>
</div>
<div class="screen" id="sInv">
<div class="card"><div class="card-title">–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</div><div class="eq-panel" id="eqPanel"></div></div>
<div class="card"><div class="card-title">–†–µ—Å—É—Ä—Å—ã</div><div class="res-bar" id="resBar"></div></div>
<div class="card"><div class="card-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div><div class="inv-grid" id="invGrid"></div></div>
</div>
<div class="screen" id="sMap"><div class="card"><div class="card-title">–õ–æ–∫–∞—Ü–∏–∏</div><div id="locList"></div></div></div>
<div class="screen" id="sCity">
<div class="tabs" id="cityTabs"><button class="tab active" onclick="window.cityTab('craft')">–ö—Ä–∞—Ñ—Ç</button><button class="tab" onclick="window.cityTab('bank')">–ë–∞–Ω–∫</button><button class="tab" onclick="window.cityTab('auc')">–ê—É–∫—Ü–∏–æ–Ω</button></div>
<div id="cityContent"></div>
</div>
<div class="screen" id="sMast"><div class="card"><div class="card-title">–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ</div><div id="mastList"></div></div></div>
</div>
<div class="nav">
<button class="nav-item active" onclick="nav('Explore',this)">üåç<span>–ú–∏—Ä</span></button>
<button class="nav-item" onclick="nav('Inv',this)">üéí<span>–°—É–º–∫–∞</span></button>
<button class="nav-item" onclick="nav('Map',this)">üó∫Ô∏è<span>–ö–∞—Ä—Ç–∞</span></button>
<button class="nav-item" onclick="nav('City',this)">üè∞<span>–ì–æ—Ä–æ–¥</span></button>
<button class="nav-item" onclick="nav('Mast',this)">üìä<span>–°–∫–∏–ª—ã</span></button>
</div>
<div class="modal" id="modal"><div class="modal-box"><div class="modal-head"><div class="modal-title" id="modTitle"></div><button class="modal-close" onclick="closeMod()">√ó</button></div><div id="modContent"></div></div></div>
<script type="module">
// –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π
import { initGame } from './js/init.js';
import { S } from './js/gameState.js';
import { startStep, stopStep } from './js/movement.js';
import { cityTab } from './js/city.js';
import { nav } from './js/ui.js';
import { renderInv } from './js/inventory.js';
import { renderLocList } from './js/locations.js';
import { renderCity } from './js/city.js';
import { renderMast } from './js/mastery.js';
import { wave, duel } from './js/events.js';

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è HTML
window.cityTab = cityTab;
window.startStep = startStep;
window.stopStep = stopStep;
window.nav = nav;
window.renderInv = renderInv;
window.renderLocList = renderLocList;
window.renderCity = renderCity;
window.renderMast = renderMast;
window.wave = wave;
window.duel = duel;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
initGame();
</script>
<script>
// –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
const $ = id => document.getElementById(id);
</script>
  city: {name: '–ì–æ—Ä–æ–¥', icon: 'üè∞', tier: 0, pvp: 'safe', isCity: 1, nodes: [{x: 50, y: 50}], paths: [], exits: {}},
  meadow: {name: '–õ—É–≥–∞', icon: 'üåø', tier: 1, pvp: 'request', nodes: [{x: 20, y: 80}, {x: 40, y: 60}, {x: 60, y: 40}, {x: 50, y: 70}, {x: 80, y: 30}], paths: [[0, 1], [1, 2], [1, 3], [2, 4], [3, 4]], enemies: ['slime', 'wolf'], res: ['wood', 'cloth'], exits: {4: 'forest'}},
  forest: {name: '–õ–µ—Å', icon: 'üå≤', tier: 2, pvp: 'request', nodes: [{x: 20, y: 30}, {x: 40, y: 50}, {x: 30, y: 70}, {x: 60, y: 40}, {x: 80, y: 60}, {x: 70, y: 80}], paths: [[0, 1], [1, 2], [1, 3], [3, 4], [2, 5], [4, 5]], enemies: ['wolf', 'bear'], res: ['wood', 'leather'], exits: {0: 'meadow', 5: 'highlands'}},
  highlands: {name: '–í—ã—Å–æ–∫–æ–≥–æ—Ä—å–µ', icon: '‚õ∞Ô∏è', tier: 3, pvp: 'open', nodes: [{x: 50, y: 20}, {x: 30, y: 40}, {x: 70, y: 40}, {x: 40, y: 60}, {x: 60, y: 60}, {x: 50, y: 80}], paths: [[0, 1], [0, 2], [1, 3], [2, 4], [3, 5], [4, 5]], enemies: ['golem', 'harpy'], res: ['metal', 'leather'], exits: {0: 'forest'}}
};

const ENEMIES = {
  slime: {name: '–°–ª–∏–∑–µ–Ω—å', icon: 'üü¢', hp: 30, dmg: 5, xp: 10, loot: ['cloth']},
  wolf: {name: '–í–æ–ª–∫', icon: 'üê∫', hp: 50, dmg: 10, xp: 20, loot: ['leather']},
  bear: {name: '–ú–µ–¥–≤–µ–¥—å', icon: 'üêª', hp: 80, dmg: 15, xp: 35, loot: ['leather', 'leather']},
  golem: {name: '–ì–æ–ª–µ–º', icon: 'üóø', hp: 120, dmg: 18, xp: 50, loot: ['metal', 'metal']},
  harpy: {name: '–ì–∞—Ä–ø–∏—è', icon: 'ü¶Ö', hp: 60, dmg: 20, xp: 45, loot: ['cloth']}
};

const PLAYERS = [
  {name: '–†—ã—Ü–∞—Ä—å_42', hp: 80, dmg: 15, loot: ['iron_sword']},
  {name: 'MagicUser', hp: 60, dmg: 20, loot: ['wooden_staff']},
  {name: '–û—Ö–æ—Ç–Ω–∏–∫', hp: 70, dmg: 18, loot: ['wooden_bow']}
];

</script>
</body>
</html>
